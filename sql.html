<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7 ie" lang="en"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8 ie" lang="en"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9 ie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" class="no-js"><!--<![endif]-->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ROSEdu Techblog - The fast-track, hands-on, no-nonsense introduction to SQL</title>
    <link rel="stylesheet" href="./css/style.css" type="text/css">
    <link rel="stylesheet" href="./css/rosedu_links.css" type="text/css">
    <link rel="stylesheet" href="./css/syntax.css" type="text/css">
    <!--<link rel="stylesheet" type="text/css" href="/css/default.css"/>-->

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-7579199-6']);
      _gaq.push(['_trackPageview']);

      (function () {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body>
    <div id="page" class="hentry">
      <header class="the-header">
        <div class="unit-head">
          <div class="unit-inner unit-head-inner">
            <nav class="nav-global">
              <ul>
                <li class="logo"><a href="./" title="Home">ROSEdu Techblog</a></li>
                <li class="about"><a href="./about.html">About</a></li>
                <li class="people"><a href="./people.html">People</a></li>
                <li class="archive"><a href="./archive.html">Archive</a></li>
                <li class="category"><a href="./tags.html">Tags</a></li>
              </ul>
            </nav>

            <hr />

            <nav class="nav-global">
              <ul>
                <li class="logo"><a href="./archive.html" title="Archive">Latest Posts</a></li>
                
                  <li><a href>Facebook Hackathon Live Blogging</a></li>
                
                  <li><a href>Shell tips and tricks for log files</a></li>
                
                  <li><a href>Git Is The Answer 3/3</a></li>
                
              </ul>
            </nav>
          </div><!-- unit-inner -->
        </div><!-- unit-head -->
      </header>

      <div class="body" role="main">
        <div class="unit-body">
          <div class="unit-inner unit-body-inner">
  <div class="entry-content">
    <article class="unit-article layout-post">
      <div class="unit-inner unit-article-inner">
        <div class="content">
          <div class="bd">
            <header>
              <div class="unit-head">
                <div class="unit-inner unit-head-inner">
                  <h1 class="h2 entry-title">
                    <a class="post_title" href="./sql.html" title="The fast-track, hands-on, no-nonsense introduction to SQL">The fast-track, hands-on, no-nonsense introduction to SQL</a>
                  </h1>
                </div><!-- unit-inner -->
              </div><!-- unit-head -->
            </header>

            <span class="date">
            <span class="published">Published on October  5, 2012</span>
            by
            <span class="author">Dan Șerban</span>
            </span>

            <br />
            <span class="meta">
              Tagged:
              <span class="tags"><a href="./tags/SQL.html">SQL</a>, <a href="./tags/RDBMS.html">RDBMS</a></span>
            </span>

            <p>Rather than relying on dry explanations of mathematical set theory, this tutorial is organized as a survey of SQL statements and techniques. It is designed to let you infer from examples what SQL is all about as well as the kinds of problems it can help you solve.</p>
<p>The promise of this tutorial is that you invest 30 minutes of your time and it will enable you to “speak” SQL right here, right now.</p>
<p>The uncompromising emphasis here is on raw speed of learning new things.</p>
<h3 id="introduction">Introduction</h3>
<p>SQL is the universal language that allows relational database management systems (RDBMS) to communicate with the outside world.</p>
<p>The easiest way for a developer to become familiar with SQL is by using SQLite, a file-based (serverless) RDBMS.</p>
<h3 id="lets-start-coding-already">Let’s start coding already!</h3>
<p>To check whether you already have SQLite on your GNU/Linux system, open up a terminal and run:</p>
<pre><code>which sqlite3 &amp;&amp; echo &quot;OK - SQLite found&quot;</code></pre>
<p>To install SQLite on Ubuntu, simply run:</p>
<pre><code>sudo apt-get install sqlite3</code></pre>
<p>The first few baby steps when learning SQL are: - creating a new database; - creating a new table inside that database; - populating the table with some data.</p>
<p>First, let’s create a new database. In a terminal, run:</p>
<pre><code>sqlite3 /tmp/dev.db</code></pre>
<p>You should see output similar to this:</p>
<pre><code>SQLite version 3.7.13 2012-06-11 02:05:22
Enter &quot;.help&quot; for instructions
Enter SQL statements terminated with a &quot;;&quot;
sqlite&gt;</code></pre>
<p>At this point, SQLite has created and appropriately formatted a new file, <code>/tmp/dev.db</code>, and is now waiting for you to tell it what to do.</p>
<p>You communicate your intent to SQLite by typing in SQL statements.</p>
<p>As we already mentioned, when we start working on a new database, the first thing we do is create a table.</p>
<p>At the <code>sqlite&gt;</code> prompt, type the following SQL statement:</p>
<p>{% highlight sql %} CREATE TABLE presidencies ( id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, first_name VARCHAR(255), other_names VARCHAR(255), year_from INTEGER, year_to INTEGER, notes TEXT ); {% endhighlight %}</p>
<p>SQLite does not give any output in response, and that means it has successfully executed the statement.</p>
<p>We now have an empty table called <code>presidencies</code>.</p>
<p>Having an empty table in a database is like having an empty spreadsheet in front of you.</p>
<p>The next step is therefore to populate the table with some data.</p>
<p>We do this by using the <code>INSERT</code> statement. Try this:</p>
<p>{% highlight sql %} INSERT INTO presidencies VALUES ( NULL, “Barack”, “Obama”, 2009, 2012, “Won against John McCain” ); {% endhighlight %}</p>
<p>Again, SQLite is not giving us any response, which means the <code>INSERT</code> statement was successfully executed.</p>
<p>If we now query the contents of the table, we should see the newly inserted row. Try this:</p>
<p>{% highlight sql %} SELECT * FROM presidencies; {% endhighlight %}</p>
<p>The output you should see is this:</p>
<pre><code>1|Barack|Obama|2009|2012|Won against John McCain</code></pre>
<p>As you can probably tell, the output is in the format:</p>
<pre><code>id|first_name|other_names|year_from|year_to|notes</code></pre>
<p>Since we set <code>id</code> to <code>NULL</code> in our <code>INSERT</code> statement and <code>id</code> has the <code>AUTOINCREMENT</code> attribute in the table definition, SQLite assigned the first available positive integer value and stored it as this record’s primary key.</p>
<p>“Primary key” simply means two things: - The developer has communicated his intention to use this field to uniquely identify each row of this table; - The RDBMS will therefore enforce the uniqueness of this key and use this information to optimize its execution of SQL statements against this table.</p>
<p>Let’s put this behavior to the test. Try the same <code>INSERT</code> statement as before, only replace <code>NULL</code> with <code>1</code> (an already existing <code>id</code>):</p>
<p>{% highlight sql %} INSERT INTO presidencies VALUES ( 1, “Barack”, “Obama”, 2009, 2012, “Won against John McCain” ); {% endhighlight %}</p>
<p>The output you should see is:</p>
<pre><code>Error: PRIMARY KEY must be unique</code></pre>
<p>To change a record in the table, we are going to use an <code>UPDATE</code> statement with a precisely targeted <code>WHERE</code> clause:</p>
<p>{% highlight sql %} UPDATE presidencies SET notes = “His campaign slogan was yes-we-can” WHERE id = 1; {% endhighlight %}</p>
<p>Query the whole table again to see the changes:</p>
<p>{% highlight sql %} SELECT * FROM presidencies; {% endhighlight %}</p>
<p>The output you should see is this:</p>
<pre><code>1|Barack|Obama|2009|2012|His campaign slogan was yes-we-can</code></pre>
<p>To remove a record from the table, we are going to use a precisely targeted <code>DELETE</code> statement:</p>
<p>{% highlight sql %} DELETE FROM presidencies WHERE id = 1; {% endhighlight %}</p>
<p>Query the whole table again to verify that it’s empty.</p>
<p>To continue exploring the features of SQL we are going to need a lot more data.</p>
<p>Paste the statements below at the <code>sqlite&gt;</code> prompt:</p>
<p>{% highlight sql %} INSERT INTO presidencies VALUES (NULL, “Theodore”, “Roosevelt”, 1905, 1908, “”); INSERT INTO presidencies VALUES (NULL, “William”, “Taft”, 1909, 1912, “”); INSERT INTO presidencies VALUES (NULL, “Woodrow”, “Wilson”, 1913, 1916, “1st term; WW 1 begins”); INSERT INTO presidencies VALUES (NULL, “Woodrow”, “Wilson”, 1917, 1920, “2nd term; WW 1 ends”); INSERT INTO presidencies VALUES (NULL, “Warren”, “Harding”, 1921, 1922, “”); INSERT INTO presidencies VALUES (NULL, “Calvin”, “Coolidge”, 1923, 1924, “1st term”); INSERT INTO presidencies VALUES (NULL, “Calvin”, “Coolidge”, 1925, 1928, “2nd term”); INSERT INTO presidencies VALUES (NULL, “Herbert”, “Hoover”, 1929, 1932, “”); INSERT INTO presidencies VALUES (NULL, “Franklin”, “D. Roosevelt”, 1933, 1936, “1st term”); INSERT INTO presidencies VALUES (NULL, “Franklin”, “D. Roosevelt”, 1937, 1940, “2nd term; WW 2 begins”); INSERT INTO presidencies VALUES (NULL, “Franklin”, “D. Roosevelt”, 1941, 1944, “3rd term”); INSERT INTO presidencies VALUES (NULL, “Harry”, “Truman”, 1945, 1948, “1st term; WW 2 ends”); INSERT INTO presidencies VALUES (NULL, “Harry”, “Truman”, 1949, 1952, “2nd term”); INSERT INTO presidencies VALUES (NULL, “Dwight”, “Eisenhower”, 1953, 1956, “1st term”); INSERT INTO presidencies VALUES (NULL, “Dwight”, “Eisenhower”, 1957, 1960, “2nd term”); INSERT INTO presidencies VALUES (NULL, “John”, “F. Kennedy”, 1961, 1963, “”); INSERT INTO presidencies VALUES (NULL, “Lyndon”, “Johnson”, 1964, 1964, “Took over when JFK was assassinated”); INSERT INTO presidencies VALUES (NULL, “Lyndon”, “Johnson”, 1965, 1968, “2nd term”); INSERT INTO presidencies VALUES (NULL, “Richard”, “Nixon”, 1969, 1972, “1st term”); INSERT INTO presidencies VALUES (NULL, “Richard”, “Nixon”, 1973, 1974, “2nd term”); INSERT INTO presidencies VALUES (NULL, “Gerald”, “Ford”, 1975, 1976, “”); INSERT INTO presidencies VALUES (NULL, “Jimmy”, “Carter”, 1977, 1980, “”); INSERT INTO presidencies VALUES (NULL, “Ronald”, “Reagan”, 1981, 1984, “1st term”); INSERT INTO presidencies VALUES (NULL, “Ronald”, “Reagan”, 1985, 1988, “2nd term”); INSERT INTO presidencies VALUES (NULL, “George”, “H. W. Bush”, 1989, 1992, “”); INSERT INTO presidencies VALUES (NULL, “Bill”, “Clinton”, 1993, 1996, “1st term”); INSERT INTO presidencies VALUES (NULL, “Bill”, “Clinton”, 1997, 2000, “2nd term”); INSERT INTO presidencies VALUES (NULL, “George”, “W. Bush”, 2001, 2004, “1st term”); INSERT INTO presidencies VALUES (NULL, “George”, “W. Bush”, 2005, 2008, “2nd term”); INSERT INTO presidencies VALUES (NULL, “Barack”, “Obama”, 2009, 2012, “”); {% endhighlight %}</p>
<p>Let’s see how many records our table contains now:</p>
<p>{% highlight sql %} SELECT COUNT(*) FROM presidencies; {% endhighlight %}</p>
<p>The table has 30 rows.</p>
<p>We want to generate a deduplicated list of all persons who held office.</p>
<p>The SQL keyword <code>DISTINCT</code> performs the deduplication magic, and we are going to make use of the SQL text concatenation operator <code>||</code>:</p>
<p>{% highlight sql %} SELECT DISTINCT first_name || ‘’ || other_names AS full_name FROM presidencies; {% endhighlight %}</p>
<p>We want to find out how many presidencies began in the second half of the 20th century.</p>
<p>{% highlight sql %} SELECT COUNT(*) FROM presidencies WHERE year_from BETWEEN 1950 AND 1999; {% endhighlight %}</p>
<p>The answer to that question is 14 records.</p>
<p>In 1941, the surprise attack at Pearl Harbor happened.</p>
<p>We would like to know who was president of the United States at that time.</p>
<p>{% highlight sql %} SELECT * FROM presidencies WHERE 1941 BETWEEN year_from AND year_to; {% endhighlight %}</p>
<p>The expected output:</p>
<pre><code>12|Franklin|D. Roosevelt|1941|1944|3rd term</code></pre>
<p>We stored some notes on when both world wars began and ended. Let’s query that information by asking for all records that contain the string &quot; WW &quot; inside the <code>notes</code> column.</p>
<p>To perform text matching we need to use the <code>LIKE</code> predicate.</p>
<p>Note: The percent sign has wildcard semantics in SQL.</p>
<p>{% highlight sql %} SELECT * FROM presidencies WHERE notes LIKE ‘% WW %’ ORDER BY year_from; {% endhighlight %}</p>
<p>The expected output:</p>
<pre><code>4|Woodrow|Wilson|1913|1916|1st term; WW 1 begins
5|Woodrow|Wilson|1917|1920|2nd term; WW 1 ends
11|Franklin|D. Roosevelt|1937|1940|2nd term; WW 2 begins
13|Harry|Truman|1945|1948|1st term; WW 2 ends</code></pre>
<p>We want a breakdown of how many presidencies were full-term (lasted the full 4 years) versus how many lasted 1 or 2 or 3 years.</p>
<p>That can also be done in SQL, however the syntax is slightly more convoluted.</p>
<p>{% highlight sql %} SELECT 1 + year_to - year_from AS duration, COUNT(*) AS cnt FROM presidencies GROUP BY duration ORDER BY cnt DESC; {% endhighlight %}</p>
<p>The expected output:</p>
<pre><code>4|24
2|4
1|1
3|1</code></pre>
<p>That means there were 24 presidencies which lasted the full 4 years, 4 which lasted 2 years etc.</p>
<p><strong>Important side note</strong></p>
<p>Being able to get predictable, consistent performance is an important part of software development, and there are some performance considerations to take into account when using <code>WHERE</code> clauses.</p>
<p>The database engine performs these <code>WHERE</code> lookups significantly faster when it can rely on indexes.</p>
<p>Let’s say we know ahead of time that the most frequent queries are going to filter by <code>year_from</code> and <code>year_to</code>.</p>
<p>In that case we need to create indexes on both fields:</p>
<p>{% highlight sql %} CREATE INDEX index_on_year_from ON presidencies (year_from); CREATE INDEX index_on_year_to ON presidencies (year_to); {% endhighlight %}</p>
<p>Indexes do not make a big difference on a table with 30 records, but it is recommended to get into the habit of thinking about indexes before SQL execution times start to grow out of control.</p>
<h3 id="foreign-key-relationships-the-one-to-many-case">Foreign key relationships: the ONE-TO-MANY case</h3>
<p>Let us now explore how we can build database models for information entities which are related to one another.</p>
<p>We are going to use the geographical hierarchy of continents <code>-&gt;</code> countries <code>-&gt;</code> cities to illustrate this. - A continent has many countries - A country has many cities</p>
<p>Conversely: - A city belongs to only one country - A country belongs to only one continent</p>
<p>To create tables for each of the three information entities, run the following commands:</p>
<p>{% highlight sql %} CREATE TABLE continents ( id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, continent_name VARCHAR(255) ); CREATE TABLE countries ( id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, continent_id INTEGER NOT NULL, country_name VARCHAR(255) ); CREATE TABLE cities ( id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, country_id INTEGER NOT NULL, city_name VARCHAR(255) ); {% endhighlight %}</p>
<p>Note: SQL experts will notice something is missing from the table definitions above. I have deliberately chosen not to cover foreign key constraints in this beginner-level tutorial in order not to place too much of a cognitive burden on the reader.</p>
<p>Let’s populate these tables with some data I have prepared for you in a file.</p>
<p>Quit SQLite with Ctrl-D, download and inspect the file as shown below:</p>
<pre><code>wget -O /tmp/geography.sql http://dserban.github.com/introduction-to-sql/geography.sql
less /tmp/geography.sql</code></pre>
<p>Load the data into our database <code>dev.db</code> (this operation may take a while on slower computers):</p>
<pre><code>sqlite3 /tmp/dev.db &lt; /tmp/geography.sql</code></pre>
<p>Now open the database again and let’s write some queries.</p>
<pre><code>sqlite3 /tmp/dev.db</code></pre>
<p>The query:</p>
<p>{% highlight sql %} SELECT * FROM continents; {% endhighlight %}</p>
<p>behaves the way you expect.</p>
<p>Next, go ahead and run the query below, and see what happens:</p>
<p>{% highlight sql %} SELECT * FROM continents AS c1, continents AS c2; {% endhighlight %}</p>
<p>The above is definitely a valid SQL statement, and I’m just showing it to you in order for you to get comfortable with the idea that SQL statements may reference more than one database table, and if you reference the same table twice, the output will be the cartesian product of the table’s row set with itself.</p>
<p>Next, try this:</p>
<p>{% highlight sql %} SELECT country_name, continent_name FROM countries, continents WHERE countries.continent_id = continents.id ORDER BY country_name; {% endhighlight %}</p>
<p>What we just did is formally called “traversing a foreign key relationship”.</p>
<p>We retrieved some records from the <code>countries</code> table, found some “pointers” in the <code>continent_id</code> column, went to the <code>continents</code> table, retrieved the continent descriptions pertaining to those pointers, and then brought back those results and associated them with each row in the <code>countries</code> table.</p>
<p>Congratulations, you have just learned about the “R” in “RDBMS”, this is what we mean by “relational”.</p>
<p>Notice one thing: the query above will start suffering from performance issues for tables beyond a certain size.</p>
<p>Before we go on, we want to take care of performance-by-design.</p>
<p>The lookups which happen during foreign key relationship traversal would be much more efficient when supported by the appropriate indexes.</p>
<p>Let’s create indexes on those foreign key columns.</p>
<p>{% highlight sql %} CREATE INDEX index_on_country_id ON cities (country_id); CREATE INDEX index_on_continent_id ON countries (continent_id); {% endhighlight %}</p>
<p>Moreover, <code>country_name</code> and <code>city_name</code> are also worth indexing, since in the future we are very likely to need to locate records based on them.</p>
<p>{% highlight sql %} CREATE INDEX index_on_city_name ON cities (city_name); CREATE INDEX index_on_country_name ON countries (country_name); {% endhighlight %}</p>
<p>Let us now write a query that performs a three-way join:</p>
<p>{% highlight sql %} SELECT city_name, country_name, continent_name FROM cities, countries, continents WHERE cities.country_id = countries.id AND countries.continent_id = continents.id ORDER BY city_name; {% endhighlight %}</p>
<p>In order to avoid repeated typing of complex queries, SQL allows us to store a given <code>SELECT</code> statement under a specific name.</p>
<p>The resulting database object is called a view.</p>
<p>Let’s create a view for the previous <code>SELECT</code> statement:</p>
<p>{% highlight sql %} CREATE VIEW augmented_cities AS SELECT city_name, country_name, continent_name FROM cities, countries, continents WHERE cities.country_id = countries.id AND countries.continent_id = continents.id; {% endhighlight %}</p>
<p>Using the newly created view, we can more comfortably find out all of the information about e.g. the city of London which our database has to offer:</p>
<p>{% highlight sql %} SELECT * FROM augmented_cities WHERE city_name = ‘London’; {% endhighlight %}</p>
<p>The output:</p>
<pre><code>London|United Kingdom|Europe</code></pre>
<p>Next, let’s look at an example of a subquery. Try this:</p>
<p>{% highlight sql %} SELECT continent_name, how_many_countries FROM continents, (SELECT continent_id, COUNT(*) AS how_many_countries FROM countries GROUP BY continent_id) AS breakdows WHERE continents.id = breakdows.continent_id; {% endhighlight %}</p>
<p>The output:</p>
<pre><code>North America|4
South America|9
Europe|32
Africa|15
Asia|17
Oceania|2</code></pre>
<p>What we did here is we joined a real table (<code>continents</code>) with a virtual one called a subquery (the result of a <code>SELECT</code> statement).</p>
<p>We can do this because SQL doesn’t really join tables, it joins rectangular result sets consisting of rows and columns.</p>
<p>Let’s store this query in a view, we are going to make use of it in a future tutorial.</p>
<p>{% highlight sql %} CREATE VIEW continent_statistics AS SELECT continent_name, how_many_countries FROM continents, (SELECT continent_id, COUNT(*) AS how_many_countries FROM countries GROUP BY continent_id) AS breakdows WHERE continents.id = breakdows.continent_id; {% endhighlight %}</p>
<h3 id="foreign-key-relationships-the-many-to-many-case">Foreign key relationships: the MANY-TO-MANY case</h3>
<p>Up to this point, we have explored SQL statements on a single table, as well as one-to-many relationships.</p>
<p>How do we model many-to-many relationships?</p>
<p>How do we model people upvoting news stories on social networks? - One person may upvote more than one story</p>
<p>Conversely: - One story may get upvoted by several people</p>
<p>How do we model project communities which collaborate on Github? - One person may contribute to more than one project</p>
<p>Conversely: - One project may get contributions from several people</p>
<p>The answer is that we need to define a separate information entity which is going to track those complex relationships for us.</p>
<p>In Github’s case, the core information entities are User and Project, and we are going to name the third one Contributorship.</p>
<p>Therefore: - A user has many contributorships - A contributorship belongs to a user - A project has many contributorships - A contributorship belongs to a project</p>
<p>Let’s go ahead and create tables for those three information entities:</p>
<p>{% highlight sql %} CREATE TABLE users ( id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, user_name VARCHAR(255) ); CREATE TABLE projects ( id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, project_name VARCHAR(255) ); CREATE TABLE contributorships ( id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, user_id INTEGER NOT NULL, project_id INTEGER NOT NULL ); {% endhighlight %}</p>
<p>And let’s populate the tables with some sample data (5 users, 9 projects):</p>
<p>{% highlight sql %} INSERT INTO users VALUES (1, “alex-morega”); INSERT INTO users VALUES (2, “gvoicu”); INSERT INTO users VALUES (3, “igstan”); INSERT INTO users VALUES (4, “dserban”); INSERT INTO users VALUES (5, “torvalds”); INSERT INTO projects VALUES (1, “torvalds/linux”); INSERT INTO projects VALUES (2, “rosedu/WebDev”); INSERT INTO projects VALUES (3, “rosedu/wouso”); INSERT INTO projects VALUES (4, “rosedu/techblog”); INSERT INTO projects VALUES (5, “rosedu/StartTheDark”); INSERT INTO projects VALUES (6, “gvoicu/miniflow”); INSERT INTO projects VALUES (7, “rails/rails”); INSERT INTO projects VALUES (8, “sinatra/sinatra”); INSERT INTO projects VALUES (9, “mitsuhiko/flask”); INSERT INTO contributorships VALUES ( 1, 1, 2); INSERT INTO contributorships VALUES ( 2, 1, 3); INSERT INTO contributorships VALUES ( 3, 1, 9); INSERT INTO contributorships VALUES ( 4, 2, 2); INSERT INTO contributorships VALUES ( 5, 2, 6); INSERT INTO contributorships VALUES ( 6, 2, 7); INSERT INTO contributorships VALUES ( 7, 2, 8); INSERT INTO contributorships VALUES ( 8, 3, 2); INSERT INTO contributorships VALUES ( 9, 3, 6); INSERT INTO contributorships VALUES (10, 4, 1); INSERT INTO contributorships VALUES (11, 4, 2); INSERT INTO contributorships VALUES (12, 4, 3); INSERT INTO contributorships VALUES (13, 4, 4); INSERT INTO contributorships VALUES (14, 4, 5); INSERT INTO contributorships VALUES (15, 4, 6); INSERT INTO contributorships VALUES (16, 4, 7); INSERT INTO contributorships VALUES (17, 4, 8); INSERT INTO contributorships VALUES (18, 5, 1); {% endhighlight %}</p>
<p>Now before we start issuing queries, let’s take care of the performance-by-design side of things.</p>
<p>We anticipate that we’ll need to do heavy querying by <code>user_name</code> and by <code>project_name</code>.</p>
<p>Therefore we need indexes on those columns:</p>
<p>{% highlight sql %} CREATE INDEX index_on_user_name ON users (user_name); CREATE INDEX index_on_project_name ON projects (project_name); {% endhighlight %}</p>
<p>It goes without saying that we need to index the foreign key columns:</p>
<p>{% highlight sql %} CREATE INDEX index_on_user_id ON contributorships (user_id); CREATE INDEX index_on_project_id ON contributorships (project_id); {% endhighlight %}</p>
<p>We also need to make sure that duplicate contributorships cannot exist.</p>
<p>We achieve this by creating a unique index on the combination of <code>user_id</code> and <code>project_id</code>:</p>
<p>{% highlight sql %} CREATE UNIQUE INDEX unique_index_on_user_id_and_project_id ON contributorships (user_id,project_id); {% endhighlight %}</p>
<p>First, let’s list all contributorships in human readable format:</p>
<p>{% highlight sql %} SELECT user_name || &quot; contributes to &quot; || project_name FROM contributorships, users, projects WHERE users.id = contributorships.user_id AND projects.id = contributorships.project_id ORDER BY user_name, project_name; {% endhighlight %}</p>
<p>The output you should get is:</p>
<pre><code>alex-morega contributes to mitsuhiko/flask
alex-morega contributes to rosedu/WebDev
alex-morega contributes to rosedu/wouso
dserban contributes to gvoicu/miniflow
dserban contributes to rails/rails
dserban contributes to rosedu/StartTheDark
dserban contributes to rosedu/WebDev
dserban contributes to rosedu/techblog
dserban contributes to rosedu/wouso
dserban contributes to sinatra/sinatra
dserban contributes to torvalds/linux
gvoicu contributes to gvoicu/miniflow
gvoicu contributes to rails/rails
gvoicu contributes to rosedu/WebDev
gvoicu contributes to sinatra/sinatra
igstan contributes to gvoicu/miniflow
igstan contributes to rosedu/WebDev
torvalds contributes to torvalds/linux</code></pre>
<p>Now let’s determine all projects for a given user, as well as the list of all people who contribute to a given project.</p>
<p>{% highlight sql %} SELECT project_name FROM contributorships, users, projects WHERE users.user_name = ‘gvoicu’ AND users.id = contributorships.user_id AND projects.id = contributorships.project_id ORDER BY project_name; {% endhighlight %}</p>
<p>The output you should get is:</p>
<pre><code>gvoicu/miniflow
rails/rails
rosedu/WebDev
sinatra/sinatra</code></pre>
<p>To list a given project’s contributors:</p>
<p>{% highlight sql %} SELECT user_name FROM contributorships, users, projects WHERE projects.project_name = ‘rosedu/WebDev’ AND users.id = contributorships.user_id AND projects.id = contributorships.project_id ORDER BY user_name; {% endhighlight %}</p>
<p>The output you should get is:</p>
<pre><code>alex-morega
dserban
gvoicu
igstan</code></pre>
<p>Finally, let’s create a view which will make it easier for us to go back and forth between users and projects:</p>
<p>{% highlight sql %} CREATE VIEW augmented_contributorships AS SELECT user_name, project_name FROM contributorships, users, projects WHERE users.id = contributorships.user_id AND projects.id = contributorships.project_id; {% endhighlight %}</p>
<h3 id="closing-words">Closing words</h3>
<p>This short overview of SQL ends here.</p>
<p>If you want to learn more SQL tips and tricks, I highly recommend <a href="http://sql.learncodethehardway.org/book/">Learn SQL The Hard Way</a></p>

          </div>
        </div>
      </div>
<!-- Social Buttons here -->
	<div id="sociallinks">
  	<a href="https://twitter.com/home?status=/sql.html" target="_blank">Tweet this</a> -
  	<a href="http://www.facebook.com/sharer/sharer.php?u=/sql.html" target="_blank">Like this</a> -
  	<a href="https://plus.google.com/share?url=/sql.html" target="_blank">Share on G+</a>
	</div>
	<script>
		(function(){window.addEventListener("DOMContentLoaded",function(){
		//get URL 
    		var url=document.location;
    		var links=document.getElementById("sociallinks")
                      .getElementsByTagName('a');
    		for (var i=0;i!=links.length;i++){
			// Replacing /sql.html with current URL
        		links[i].setAttribute("href",
            		links[i].href.replace('/sql.html',url));}})})();
	</script>
	</br>
    </article>
  </div>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'rosedutechblog';
  var disqus_url = window.location.href.split('/').splice(0,3).join("/")+'/sql.html';
  var title = 'The fast-track, hands-on, no-nonsense introduction to SQL';
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        </div>
      </div>

      <footer class="the-footer">
        <div class="unit-foot">
          <div class="unit-inner unit-foot-inner">
            <div class="misc vcard">
              <h4>Social</h4>
              <div class="rss">
                <a href="http://feeds.feedburner.com/rosedu/tech" target="_blank">
                  <img src="./images/rss.png" alt="Subscribe to RSS Feed" />
                </a>
                <a href="http://www.reddit.com/submit?url='+encodeURIComponent(window.location)" target="_blank" onclick="window.location='http://www.reddit.com/submit?url='+encodeURIComponent(window.location); return false">
                  <img src="./images/reddit.png" alt="Submit to Reddit" />
                </a>
                <a href="http://twitter.com/share" class="twitter-share-button" data-count="none" target="_blank">
                  <img src="./images/twitter.png" alt="Submit to Twitter" />
                </a>
              </div>

              <h4>Powered by</h4>
              <ul>
                <li class="contact">
                  <address>
                    <a class="author fn n" href="http://www.rosedu.org">ROSEdu</a>
                  </address>
                </li>
                <li class="contact">
                  <address>
                    <a class="author fn n" href="http://jaspervdj.be/hakyll">Hakyll</a>
                  </address>
                </li>
              </ul>

              <h4>License</h4>
              <div class="bucket">
                <span>
                  <a rel="license" href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons Attribution 3.0 License">
                    <img src="//i.creativecommons.org/l/by/3.0/88x31.png" alt="License">
                  </a>
                </span>
                <span>
                  This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/" class="subfoot">Creative Commons Attribution 3.0 License</a>.
                </span>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>
